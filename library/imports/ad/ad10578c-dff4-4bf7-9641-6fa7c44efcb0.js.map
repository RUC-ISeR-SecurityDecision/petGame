{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\load\\JS/assets\\load\\JS\\load.js"],"names":["GlobalData","require","wave","canvasHeight","canvasWidth","waveHeight","waveWidth","xOffset","speed","levelHeight","cc","Class","extends","Component","properties","btnSound","default","url","AudioClip","loadingBar","Graphics","startBtn","Button","init","console","log","date","Date","year","getFullYear","month","getMonth","dat","getDate","hour","getHours","minute","getMinutes","second","getSeconds","timeStr","flagLocation","serverAddr","data","loginTime","HttpHelper","httpPost","res","userID","flagNewUser","Number","contLoginDays","drawWave","ctx","startX","clear","time","moveTo","x","y","Math","sin","lineTo","fill","onStartBtnClicked","raw","soundVolume","btnSoundID","audioEngine","play","director","loadScene","onLoad","node","active","start","preloadScene","update","bindEnter","e","instance","detail","userInfo","userGender","gender","userName","nickName","userAvatarUrl","wx","showModal","title","content","success","confirm","openSetting","getSetting","authSetting","settingdata","login","cancel"],"mappings":"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","file":"load.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\load\\JS","sourcesContent":["// 加载数据\r\nvar GlobalData = require(\"globalData\");\r\n// 加载框水波对象\r\nvar wave = {\r\n    canvasHeight: 200,  // 画面高度\r\n    canvasWidth: 300, // 画面宽度\r\n    waveHeight: 10, // 水波高度\r\n    waveWidth: 0.02,// 水波宽度\r\n    xOffset: 0, // 波浪的横坐标偏移\r\n    speed: 0.1, // 波浪速度\r\n    levelHeight: 10 // 水平线\r\n}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //音效\r\n        btnSound: {//按键音\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        loadingBar: cc.Graphics,\r\n        startBtn: cc.Button\r\n    },\r\n\r\n    init: function(){\r\n        console.log(\"init\", GlobalData);\r\n\r\n        // test for login: wangc\r\n        let date = new Date();\r\n        let year = date.getFullYear(); //获取当前年份   \r\n        let month = date.getMonth() + 1; //获取当前月份   \r\n        let dat = date.getDate(); //获取当前日    \r\n        let hour = date.getHours(); //获取小时   \r\n        let minute = date.getMinutes(); //获取分钟   \r\n        let second = date.getSeconds(); //获取秒   \r\n        let timeStr = year + '-' + month + '-' + dat + ' ' + hour + ':' + minute + ':' + second;\r\n        let flagLocation = GlobalData.flagLocation;\r\n        let serverAddr = GlobalData.serverAddr + \"php/login.php\";\r\n        // 调用自定义网路接口进行登录操作\r\n        var data = {\r\n            loginTime: timeStr,\r\n            flagLocation: flagLocation,\r\n        };\r\n        HttpHelper.httpPost(serverAddr, data, function (res) { //---\r\n            if (res != -1) { \r\n                console.log(res);\r\n                GlobalData.userID = res.userID;\r\n                GlobalData.flagNewUser = Number(res.flagNewUser);\r\n                GlobalData.contLoginDays = Number(res.contLoginDays);\r\n            }\r\n        });\r\n\r\n        console.log('登录完成');\r\n\r\n        // console.log(globalData.species);\r\n    },\r\n\r\n    drawWave: function() {\r\n        var ctx = this.loadingBar;\r\n        const startX = 0;\r\n        ctx.clear();\r\n\r\n        this.time += 1;\r\n        wave.xOffset += wave.speed;\r\n        wave.levelHeight += 1;\r\n        ctx.moveTo(0, 0);\r\n        for (let x = startX; x < startX + wave.canvasWidth; x += 20 / wave.canvasWidth) {\r\n            const y = wave.waveHeight * Math.sin((startX + x) * wave.waveWidth + wave.xOffset) + wave.levelHeight;\r\n            ctx.lineTo(x, y);\r\n        }\r\n        ctx.lineTo(wave.canvasWidth, 0);\r\n        ctx.lineTo(startX, 0);\r\n        ctx.fill();\r\n    },\r\n\r\n    onStartBtnClicked: function() {\r\n        //播放按键音\r\n        this.btnSound=cc.url.raw('resources/sound/button/1.mp3');\r\n        var soundVolume = 0.5;\r\n        var btnSoundID = cc.audioEngine.play(this.btnSound, false, soundVolume);\r\n        //var btnSoundID = cc.audioEngine.play(this.btnSound, false, GlobalData.soundVolume);\r\n        console.log('turn to adopt page');\r\n        cc.director.loadScene(\"portrayPage\");\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.init();\r\n        this.time = 0;\r\n        this.startBtn.node.active = false;\r\n    },\r\n\r\n    start () {\r\n        cc.director.preloadScene(\"portrayPage\", function () {\r\n            cc.log(\"Next scene preloaded\");\r\n        });\r\n    },\r\n\r\n    update () {\r\n        if (wave.levelHeight < 150) {\r\n            this.drawWave();\r\n        }\r\n        else {\r\n            this.startBtn.node.active = true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 进入游戏”按键所对应的事件处理函数，在用户的授权下获得并更新一些用户信息\r\n     * 需要微信接口，测试时可以先注释掉\r\n     * author: qll\r\n     * time: 2020/1/16\r\n     */\r\n    bindEnter: function (e) {\r\n        let instance = this;\r\n        if (e.detail.userInfo) {   //获得用户的微信账户信息\r\n            console.log(e.detail.userInfo);\r\n            GlobalData.userGender = e.detail.userInfo.gender;\r\n            GlobalData.userName = e.detail.userInfo.nickName;\r\n            GlobalData.userAvatarUrl = e.detail.userInfo.userAvatarUrl;\r\n        }\r\n        else {\r\n            wx.showModal({\r\n                title: '用户未授权',\r\n                content: '拒绝授权将不能体验小游戏完整功能，点击确定开启授权',\r\n                success: (res) => {\r\n                    console.log(res);\r\n                    if (res.confirm) {\r\n                        wx.openSetting({});\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        //询问用户是否授权位置信息（一个实际上不必要的授权，用来测试用户的安全意识）\r\n        wx.getSetting({\r\n            success(res) {\r\n                if (res.authSetting['scope.userLocation'] != true) {\r\n                    wx.showModal({\r\n                        title: '定位授权',\r\n                        content: '萌宠物语请求获得您的位置信息，请确认授权',\r\n                        success: (res) => {\r\n                            console.log(res);\r\n                            if (res.confirm) {\r\n                                wx.openSetting({\r\n                                    success(settingdata) {\r\n                                        console.log(settingdata);\r\n                                        if (settingdata.authSetting['scope.userLocation']) {\r\n                                            GlobalData.flagLocation = 1;\r\n                                            console.log(\"位置授权成功\");\r\n                                            instance.login();\r\n                                        }\r\n                                        else {\r\n                                            GlobalData.flagLocation = 0;\r\n                                            console.log(\"取消位置授权\");\r\n                                            instance.login();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            }\r\n                            if (res.cancel) {\r\n                                GlobalData.flagLocation = 0;\r\n                                console.log(\"位置授权失败\");\r\n                                instance.login();\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n     /**\r\n     *  登录函数\r\n     *  需要微信接口，测试时可以先注释掉\r\n     *  author: qll\r\n     *  time: 2020/01/16\r\n     */\r\n    login: function () {\r\n        // wx.login({\r\n        //     success: res => {\r\n        //         // 发送 res.code 到后台并收取生成的userID，\r\n        //         let js_code = res.code;\r\n        //         console.log(js_code);\r\n        //         let date = new Date();\r\n        //         let year = date.getFullYear(); //获取当前年份   \r\n        //         let month = date.getMonth() + 1; //获取当前月份   \r\n        //         let dat = date.getDate(); //获取当前日    \r\n        //         let hour = date.getHours(); //获取小时   \r\n        //         let minute = date.getMinutes(); //获取分钟   \r\n        //         let second = date.getSeconds(); //获取秒   \r\n        //         let timeStr = year + '-' + month + '-' + dat + ' ' + hour + ':' + minute + ':' + second;\r\n        //         let flagLocation = GlobalData.flagLocation;\r\n        //         let serverAddr = GlobalData.serverAddr + \"php/login.php\";\r\n        //         // 调用自定义网路接口进行登录操作\r\n        //         let data = {\r\n        //             \"js_code\": js_code,\r\n        //             \"loginTime\": timeStr,\r\n        //             \"flagLocation\": flagLocation,\r\n        //         };\r\n        //         HttpHelper.httpPost(serverAddr, data, function(res) {\r\n        //          if (res != -1) {\r\n        //                 console.log(res);\r\n        //                 GlobalData.userID = res.userID;\r\n        //                 GlobalData.flagNewUser = Number(res.flagNewUser);\r\n        //                 GlobalData.contLoginDays = Number(res.contLoginDays);\r\n        //                 GlobalData.flagContLoginReward = Number(res.flagContLoginReward);\r\n        //                 GlobalData.flagLoginReward = Number(res.flagLoginReward);\r\n        //          }\r\n        //         });\r\n        //     }\r\n        // })\r\n\r\n        console.log('登录完成');\r\n\r\n        if (GlobalData.flagNewUser == 1)//新用户，跳到领养界面\r\n        {\r\n            cc.director.loadScene(\"portrayPage\");\r\n        }\r\n        else   //老用户，查询属性信息，恢复场景，生成奖励\r\n        {\r\n            cc.director.loadScene(\"main\");\r\n        }\r\n    },\r\n});\r\n"]}